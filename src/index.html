<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title><%= htmlWebpackPlugin.options.title %></title>

  <meta name="description" content="<%= htmlWebpackPlugin.options.title %>">

  <% if (webpackConfig.htmlElements.headTags) { %>
  <!-- Configured Head Tags  -->
  <%= webpackConfig.htmlElements.headTags %>
  <% } %>

  <!-- base url -->
  <base href="<%= htmlWebpackPlugin.options.metadata.baseUrl %>">


</head>

<body>

  <app>
    Loading...
  </app>

  <button id="signin-button" onclick="handleSignInClick()">Sign In</button>
  <button id="signout-button" onclick="handleSignOutClick()">Sign Out</button>
  <% if (htmlWebpackPlugin.options.metadata.isDevServer && htmlWebpackPlugin.options.metadata.HMR !== true) { %>
  <!-- Webpack Dev Server reload -->
  <script src="/webpack-dev-server.js"></script>
  <% } %>
  <!--<script async defer src="https://apis.google.com/js/api.js"></script>-->
  
  <!--<script src="https://apis.google.com/js/platform:client.js?onload=apiLoaded" async defer></script>-->

  <script type="text/javascript">
     function handleClientLoad() {
       // Loads the client library and the auth2 library together for efficiency.
       // Loading the auth2 library is optional here since `gapi.client.init` function will load
       // it if not already loaded. Loading it upfront can save one network request.
       gapi.load('client:auth2', initClient);
     }

     function initClient() {
       // Initialize the client with API key and People API, and initialize OAuth with an
       // OAuth 2.0 client ID and scopes (space delimited string) to request access.
       gapi.client.init({
         apiKey: 'AIzaSyDHitjuCrTBW7h9meDsW-59iuDZE55hSw8',
         clientId: '1043387098142-peemn3h6s0hh631rhh8hfedq7t0ng6er.apps.googleusercontent.com',
         scope: 'https://www.googleapis.com/auth/fusiontables',
         response_type:'code'
       }).then(function () {
         // Listen for sign-in state changes.
         gapi.auth2.getAuthInstance().isSignedIn.listen(updateSigninStatus);

         // Handle the initial sign-in state.
         updateSigninStatus(gapi.auth2.getAuthInstance().isSignedIn.get());
       });
     }

     function updateSigninStatus(isSignedIn) {
       // When signin status changes, this function is called.
       // If the signin status is changed to signedIn, we make an API call.
       //console.log(gapi.auth2.getAuthInstance().currentUser.get().getAuthResponse().id_token)
       console.log(gapi.auth2.getAuthInstance().currentUser.get())

       if (isSignedIn) {
         makeApiCall();
       }
     }

     function handleSignInClick(event) {
       // Ideally the button should only show up after gapi.client.init finishes, so that this
       // handler won't be called before OAuth is initialized.
       gapi.auth2.getAuthInstance().signIn();
     }

     function handleSignOutClick(event) {
       gapi.auth2.getAuthInstance().signOut();
     }

     function makeApiCall() {
       // Make an API call to the People API, and print the user's given name.

       //gapi.client.setApiKey('AIzaSyA0FVy-lEr_MPGk1p_lHSrxGZDcxy6wH4o');

       var query = "INSERT INTO 1iVYS6XMviFJPkZqNqQ-mcujExUA66X0c9apvkhQ3 (LionelId) VALUES ('vMM_4wii!') ";
       /*
       gapi.client.load('fusiontables', 'v2', function () {
         gapi.client.fusiontables.query.sql({ sql: query }).execute(function (response) { console.log(response); });
       });
       */
       /*

       gapi.client.people.people.get({
         resourceName: 'people/me'
       }).then(function (response) {
         console.log('Hello, ' + response.result.names[0].givenName);
       }, function (reason) {
         console.log('Error: ' + reason.result.error.message);
       });*/
     }
  </script>

  <script async defer src="https://apis.google.com/js/api.js"
          onload="this.onload=function(){};handleClientLoad()"
          onreadystatechange="if (this.readyState === 'complete') this.onload()">
  </script>

</body>
</html>
